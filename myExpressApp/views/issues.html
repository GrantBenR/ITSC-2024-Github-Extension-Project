<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="stylesheets/app.css"> -->
    <title>Issues</title>
    <style>
        *{
            font-family:Segoe UI, SegoeUI, Arial, sans-serif;
            margin: 0;
            padding: 0;
            color: white;
        }
        body{
            background-color: #161b22;
        }
        header{
            display:inline-block;
            width: 100%;
            position: fixed;
            top: 0;
        }
        #content{
            padding:10em;
        }
        nav{
            display:inline-block;
            background-color: red;
            width: 100%;
        }
        ul{
            
            width: 100%;
        }
        .navLi{
            width: 20%;
            padding: 0.5em 0em 0.5em 0em;
            background-color: #57606a;
            list-style-type: none;
            display:block; 
            text-align: center;
            float:left;
        }
        .navLi:hover{
            background-color: #383c40;
        }
        .navLi a{
            width: 100%;
           
            color: #FFFFFF;
            text-decoration:none;
        }
        #SiteHeader{
            text-align: center;
            background-color: #161b22;
            color: #FFFFFF;
            padding: 0.5em;
        }
        #CurrentTab{
            background-color:#383c40;
        }
        canvas{
            background-color: #FFFFFF;
        }
        .CanvasWrapper{
            background-color: #FFFFFF;
            padding:2em 2em 2em 2em;
            margin: 3em 3em 3em 3em;
            border-radius:3em;
            margin: 3em 20% 3em 20%;
        }
    </style>
</head>
<body>
    <header>
        <h1 id="SiteHeader">Visualization for GitHub Issues Timer Data</h1>
        <nav>
            <ul>
                <li class="navLi">
                    <a href="http://localhost:5220/views/main">Home</a>
                </li>
                <li class="navLi">
                    <a href="http://localhost:5220/views/users">Users</a>
                </li>
                <li class="navLi" id="CurrentTab">
                    <a href="http://localhost:5220/views/issues">Issues</a>
                </li>
                <li class="navLi">
                    <a href="http://localhost:5220/views/timers">Timers</a>
                </li>
                <li class="navLi">
                    <a href="http://localhost:5220/views/timerperiods">Timer Periods</a>
                </li>
            </ul>
        </nav>
    </header>
    
    <div id="content">
        <H1> ISSUES DATA</H1>
        <div class="CanvasWrapper">
            <canvas id="timeSpent">

            </canvas>
            <canvas id="timeSpentByUser">

            </canvas>
        </div>
        
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        //IssueTimeSpent
        var timeSpentArray;
        var issueNames;
        

        //IssueTimeSpentByUser
        var issueName;
        var userNames;
        var timeSpentByUserArray;
        Main();
        async function Main()
        {
            await IssueTimeSpentDataGet();
            await DrawIssueTimeSpentGraph();
            await IssueTimeSpentByUserDataGet(1);
            await IssueTimeSpentByUserGraph();

        }
        async function IssueTimeSpentDataGet()
        {
            const allIssuesResponse = await fetch("http://localhost:5220/issue");
            const allIssues = await allIssuesResponse.json();
            timeSpentArray = await Promise.all(allIssues.map(async function(index){
                const issueTimeResponse = await fetch("http://localhost:5220/issuemodel/" + index.id + "/timespent");
                const issueTime = await issueTimeResponse.json();
                return issueTime.totaltimespent;
            }));
            issueNames = allIssues.map(function(index){
                    return index.issueName;
            });
        }
        async function DrawIssueTimeSpentGraph() 
        {
            const xValues = [100,200,300,400,500,600,700,800,900,1000];
            var myChart = document.getElementById("timeSpent");
            new Chart(myChart, {
                type: 'bar',
                data: {
                labels: issueNames,
                datasets: [{
                    label: 'TOTAL TIME SPENT BY ALL USERS ON THE ISSUE IN SECONDS',
                    data: timeSpentArray,
                    borderWidth: 1
                }]
                },
                options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
                }
            });
        }
        async function IssueTimeSpentByUserDataGet(issueId)
        {
            const myIssueResponse = await fetch("http://localhost:5220/issue/" + issueId);
            const myIssue = await allIssuesResponse.json();
            issueName = myIssue.issueName;

            const issueTimeResponse = await fetch("http://localhost:5220/issuemodel/" + myIssue.id + "/timespentbyuser");
            const issueTime = await issueTimeResponse.json();
            return issueTime.totaltimespent;
            issueNames = allIssues.map(function(index){
                    return index.issueName;
            });
        }
        async function IssueTimeSpentByUserGraph()
        {
            var myChart = document.getElementById("timeSpentByUser");
            const data = {
            labels: userNames,
            datasets: [{
                label: issueName,
                data: timeSpentByUserArray,
                // backgroundColor: [
                // 'rgb(255, 99, 132)',
                // 'rgb(54, 162, 235)',
                // 'rgb(255, 205, 86)'
                // ],
                hoverOffset: 4
            }]};
            const config = {
                type: 'pie',
                data: data,
            };
        }
    </script>
</body>
</html>